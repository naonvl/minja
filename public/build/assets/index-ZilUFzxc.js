import{_ as J}from"./VCheckboxBtn-CLUSfk7K.js";import{_ as O}from"./AppSelect.vue_vue_type_script_setup_true_lang-yQyeXNaI.js";import{u as P}from"./useApi-CQU_VL0x.js";import{d as R,k as j,r as d,w as G,o as n,c as p,b as s,f as u,F as _,i as b,e as x,v as D,a6 as g,z as U,g as B,x as I}from"./main-Cw_rNav5.js";import{$ as W}from"./api-C2J-NmL_.js";import{V as z,a as L,b as H,c as K}from"./VWindowItem-BLkn4nUa.js";import{V as Q}from"./VCard-BO0mHF_T.js";import{V as X}from"./VCardText-DgJEIEfc.js";import{V as Y,a as V}from"./VRow-B-H4ECCK.js";import"./VTextField-YOzaYF7_.js";import"./index-esyx9PPF.js";import"./VImg-CSqWznxm.js";import"./VOverlay-BkLxlIre.js";import"./VSelect-g_9WCqB2.js";import"./VList-Dwae-fnM.js";import"./VAvatar-QhnxoGsn.js";import"./VDivider-CpzLdSvi.js";import"./VMenu-D-fwDrhc.js";import"./VChip-CGeF-Vhz.js";import"./index-BYrzgnBV.js";/* empty css              */const Z={key:0,class:"mt-5"},ee={class:"d-flex justify-end"},ae={class:"w-full d-flex justify-end"},xe=R({__name:"index",setup(te){const E=j(),c=d([1]),w=d([]),T=d([]),S=d([]),C=d([]),l=d([]);(async()=>{try{const t=await P("/data-masters?all=1",{method:"GET"});if(t.data.value){const m=(await t.data.value).data,k=m.filter(e=>e.type_master_data==="task"),i=m.filter(e=>e.type_master_data==="produk"),o=m.filter(e=>e.type_master_data==="brand"),r=k.map(e=>({title:e.name,value:e.id})),M=i.map(e=>({title:e.name,value:e.id})),A=o.map(e=>({title:e.name,value:e.id})),h=(await(await P("/employees",{method:"GET"})).data.value).data.map(e=>({title:e.fullname,value:e.id})),y=localStorage.getItem("unsavedFormData");h.forEach((e,ie)=>{y?(l.value[e.value]=JSON.parse(y)[e.value],c.value[e.value]=JSON.parse(y)[e.value].activities.length):(l.value[e.value]={employee:e.value,activities:[{qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"}]},c.value[e.value]=1)}),w.value=h,a.value=h[0],T.value=r,S.value=M,C.value=A}}catch(t){console.error(t)}})();const F=t=>{c.value[a.value.value]-=1,l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1)},N=()=>{c.value[a.value.value]=c.value[a.value.value]+1,l.value[a.value.value].activities.push({qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"})},$=async()=>{await Promise.all(l.value.map(async t=>{if(t.activities[0].task&&t.activities[0].task!=="Pilih Tugas"&&t.activities[0].task!=="null"){const v=await W("/activities",{method:"POST",body:{employee_id:t.employee,activities:t.activities}});console.log(v)}else console.log("Task is required")})),localStorage.removeItem("unsavedFormData"),E.replace("/apps/activities/list")};G(()=>l.value,t=>{localStorage.setItem("unsavedFormData",JSON.stringify(t))},{deep:!0});const f=d("window1"),a=d({title:"",value:1}),q=t=>{a.value=t,console.log(t)};return(t,v)=>{const m=O,k=J;return n(),p(_,null,[s(z,{modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=i=>f.value=i),class:"v-tabs-pill"},{default:u(()=>[(n(!0),p(_,null,b(w.value,(i,o)=>(n(),B(H,{onClick:r=>q(i),key:i.value},{default:u(()=>[D(I(o+1)+". "+I(i.title),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"]),l.value[a.value.value]?(n(),p("div",Z,[s(L,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=i=>f.value=i)},{default:u(()=>[(n(),p(_,null,b(3,i=>s(K,{key:`window${i}`},{default:u(()=>[s(Q,{title:"Aktifitas"},{default:u(()=>[s(X,null,{default:u(()=>[(n(!0),p(_,null,b(c.value[a.value.value],o=>(n(),p("div",{key:o,class:"border rounded pa-3 mb-3"},[s(Y,{class:"position-relative"},{default:u(()=>[s(V,{cols:"12",md:"3"},{default:u(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].brand,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].brand=r,items:C.value,label:"Brand",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:u(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].task,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].task=r,items:T.value,label:"Tugas",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:u(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].product,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].product=r,items:S.value,label:"Produk",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:u(()=>[s(k,{modelValue:l.value[a.value.value].activities[o-1].qty,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].qty=r,label:"Jumlah (Pcs)",placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),c.value[a.value.value]>1?(n(),B(g,{key:0,icon:"tabler-trash",color:"error",onClick:r=>F(o),class:"position-absolute",style:{top:"-20px",right:"-20px"}},null,8,["onClick"])):U("",!0)]),_:2},1024)]))),128)),x("div",ee,[s(g,{class:"mt-6","prepend-icon":"tabler-plus",onClick:N},{default:u(()=>[D(" Tambah ")]),_:1})])]),_:1})]),_:1})]),_:2},1024)),64))]),_:1},8,["modelValue"]),x("div",ae,[s(g,{class:"mt-6","prepend-icon":"tabler-check",color:"success",onClick:$},{default:u(()=>[D(" Simpan Semua ")]),_:1})])])):U("",!0)],64)}}});export{xe as default};
