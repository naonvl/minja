import{_ as J}from"./VCheckboxBtn-BKiP3Gi5.js";import{_ as O}from"./AppSelect.vue_vue_type_script_setup_true_lang-CESMUkeS.js";import{u as P}from"./useApi-6jvaSTm6.js";import{d as R,k as j,r as d,w as G,o as n,c as p,b as o,f as u,F as _,i as b,e as x,v as D,a6 as w,z as U,g as B,x as I}from"./main-C9A6XQTW.js";import{$ as W}from"./api-Buy2-0-3.js";import{V as z,a as L,b as H,c as K}from"./VWindowItem-CT1cU4YN.js";import{V as Q}from"./VCard-CQbfvIRL.js";import{V as X}from"./VCardText-CZu89Emk.js";import{V as Y,a as V}from"./VRow-CFSAp8Jp.js";import"./VTextField-G5cmMsTz.js";import"./index-BHn3uMzb.js";import"./VImg-CKHYIO9o.js";import"./VOverlay-BbELFa2t.js";import"./VSelect-Cmccw7Pw.js";import"./VList-CjLDyuiF.js";import"./VAvatar-CJ6FnYJl.js";import"./VDivider-Bk5mrp_K.js";import"./VMenu-BDQnyxMi.js";import"./VChip-BfwPYcNX.js";import"./index-BYrzgnBV.js";/* empty css              */const Z={key:0,class:"mt-5"},ee={class:"d-flex justify-end"},ae={class:"w-full d-flex justify-end"},xe=R({__name:"index",setup(te){const E=j(),c=d([1]),g=d([]),S=d([]),T=d([]),C=d([]),t=d([]);(async()=>{try{const l=await P("/data-masters?all=1",{method:"GET"});if(l.data.value){const m=(await l.data.value).data,k=m.filter(e=>e.type_master_data==="task"),i=m.filter(e=>e.type_master_data==="produk"),s=m.filter(e=>e.type_master_data==="brand"),r=k.map(e=>({title:e.name,value:e.id})),q=i.map(e=>({title:e.name,value:e.id})),A=s.map(e=>({title:e.name,value:e.id})),h=(await(await P("/employees",{method:"GET"})).data.value).data.map(e=>({title:e.fullname,value:e.id})),y=localStorage.getItem("unsavedFormData");h.forEach((e,ie)=>{y?(t.value[e.value]=JSON.parse(y)[e.value],c.value[e.value]=JSON.parse(y)[e.value].activities.length):(t.value[e.value]={employee:e.value,activities:[{qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"}]},c.value[e.value]=1)}),g.value=h,a.value=h[0],S.value=r,T.value=q,C.value=A}}catch(l){console.error(l)}})();const F=l=>{c.value[a.value.value]-=1,t.value[a.value.value].activities.splice(l,1),t.value[a.value.value].activities.splice(l,1),t.value[a.value.value].activities.splice(l,1),t.value[a.value.value].activities.splice(l,1)},N=()=>{c.value[a.value.value]=c.value[a.value.value]+1,t.value[a.value.value].activities.push({qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"})},$=async()=>{await Promise.all(t.value.map(async l=>{const v=await W("/activities",{method:"POST",body:{employee_id:l.employee,activities:l.activities}});console.log(v)})),localStorage.removeItem("unsavedFormData"),E.replace("/apps/activities/list")};G(()=>t.value,l=>{localStorage.setItem("unsavedFormData",JSON.stringify(l))},{deep:!0});const f=d("window1"),a=d({title:"",value:1}),M=l=>{a.value=l,console.log(l)};return(l,v)=>{const m=O,k=J;return n(),p(_,null,[o(z,{modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=i=>f.value=i),class:"v-tabs-pill"},{default:u(()=>[(n(!0),p(_,null,b(g.value,(i,s)=>(n(),B(H,{onClick:r=>M(i),key:i.value},{default:u(()=>[D(I(s+1)+". "+I(i.title),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"]),t.value[a.value.value]?(n(),p("div",Z,[o(L,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=i=>f.value=i)},{default:u(()=>[(n(),p(_,null,b(3,i=>o(K,{key:`window${i}`},{default:u(()=>[o(Q,{title:"Aktifitas"},{default:u(()=>[o(X,null,{default:u(()=>[(n(!0),p(_,null,b(c.value[a.value.value],s=>(n(),p("div",{key:s,class:"border rounded pa-3 mb-3"},[o(Y,{class:"position-relative"},{default:u(()=>[o(V,{cols:"12",md:"3"},{default:u(()=>[o(m,{modelValue:t.value[a.value.value].activities[s-1].brand,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].brand=r,items:C.value,label:"Brand",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(V,{cols:"12",md:"3"},{default:u(()=>[o(m,{modelValue:t.value[a.value.value].activities[s-1].task,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].task=r,items:S.value,label:"Tugas",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(V,{cols:"12",md:"3"},{default:u(()=>[o(m,{modelValue:t.value[a.value.value].activities[s-1].product,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].product=r,items:T.value,label:"Produk",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(V,{cols:"12",md:"3"},{default:u(()=>[o(k,{modelValue:t.value[a.value.value].activities[s-1].qty,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].qty=r,label:"Jumlah (Pcs)",placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),c.value[a.value.value]>1?(n(),B(w,{key:0,icon:"tabler-trash",color:"error",onClick:r=>F(s),class:"position-absolute",style:{top:"-20px",right:"-20px"}},null,8,["onClick"])):U("",!0)]),_:2},1024)]))),128)),x("div",ee,[o(w,{class:"mt-6","prepend-icon":"tabler-plus",onClick:N},{default:u(()=>[D(" Tambah ")]),_:1})])]),_:1})]),_:1})]),_:2},1024)),64))]),_:1},8,["modelValue"]),x("div",ae,[o(w,{class:"mt-6","prepend-icon":"tabler-check",color:"success",onClick:$},{default:u(()=>[D(" Simpan Semua ")]),_:1})])])):U("",!0)],64)}}});export{xe as default};
