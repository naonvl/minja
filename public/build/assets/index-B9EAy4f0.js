import{_ as J}from"./VCheckboxBtn-DN7CUPU7.js";import{_ as O}from"./AppSelect.vue_vue_type_script_setup_true_lang-COG6PGKQ.js";import{u as P}from"./useApi-BLOb0wok.js";import{d as R,k as j,r as d,w as G,o as n,c as m,b as l,f as u,F as _,i as y,e as x,v as D,a6 as w,z as U,g as B,x as I}from"./main-BTg9bMtt.js";import{$ as W}from"./api-DZvvG-kN.js";import{V as z,a as L,b as H,c as K}from"./VWindowItem-Br-ZRbur.js";import{V as Q}from"./VCard-Bek_KHji.js";import{V as X}from"./VCardText-D38AISll.js";import{V as Y,a as V}from"./VRow-Cm2weuok.js";import"./VTextField-DU2n18Ex.js";import"./index-C6WemI_K.js";import"./VImg-glX9ijsE.js";import"./VOverlay-D-ini0Hn.js";import"./VSelect-By7Rxhkn.js";import"./VList-CZGiPWFO.js";import"./VAvatar-JfF8YMoq.js";import"./VDivider-ak2BmXWs.js";import"./VMenu-DKSncBYL.js";import"./VChip-DcT_hpFz.js";import"./index-BYrzgnBV.js";/* empty css              */const Z={key:0,class:"mt-5"},ee={class:"d-flex justify-end"},ae={class:"w-full d-flex justify-end"},xe=R({__name:"index",setup(te){const E=j(),v=d([1]),S=d([]),T=d([]),g=d([]),C=d([]),t=d([]);(async()=>{try{const o=await P("/data-masters?all=1",{method:"GET"});if(o.data.value){const c=(await o.data.value).data,k=c.filter(e=>e.type_master_data==="task"),i=c.filter(e=>e.type_master_data==="produk"),s=c.filter(e=>e.type_master_data==="brand"),r=k.map(e=>({title:e.name,value:e.id})),q=i.map(e=>({title:e.name,value:e.id})),A=s.map(e=>({title:e.name,value:e.id})),h=(await(await P("/employees",{method:"GET"})).data.value).data.map(e=>({title:e.fullname,value:e.id})),b=localStorage.getItem("unsavedFormData");h.forEach((e,ie)=>{b?(t.value[e.value]=JSON.parse(b)[e.value],v.value[e.value]=JSON.parse(b)[e.value].activities.length):(t.value[e.value]={employee:e.value,activities:[{qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"}]},v.value[e.value]=1)}),S.value=h,a.value=h[0],T.value=r,g.value=q,C.value=A}}catch(o){console.error(o)}})();const F=o=>{v.value[a.value.value]-=1,t.value[a.value.value].activities.splice(o,1),t.value[a.value.value].activities.splice(o,1),t.value[a.value.value].activities.splice(o,1),t.value[a.value.value].activities.splice(o,1)},N=()=>{v.value[a.value.value]=v.value[a.value.value]+1,t.value[a.value.value].activities.push({qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"})},$=async()=>{await W("/activities",{method:"POST",body:{employee_id:t.value[a.value.value].employee,activities:t.value[a.value.value].activities}}),localStorage.removeItem("unsavedFormData"),E.replace("/apps/activities/list")};G(()=>t.value,o=>{localStorage.setItem("unsavedFormData",JSON.stringify(o))},{deep:!0});const f=d("window1"),a=d({title:"",value:1}),M=o=>{a.value=o,console.log(o)};return(o,p)=>{const c=O,k=J;return n(),m(_,null,[l(z,{modelValue:f.value,"onUpdate:modelValue":p[0]||(p[0]=i=>f.value=i),class:"v-tabs-pill"},{default:u(()=>[(n(!0),m(_,null,y(S.value,(i,s)=>(n(),B(H,{onClick:r=>M(i),key:i.value},{default:u(()=>[D(I(s+1)+". "+I(i.title),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"]),t.value[a.value.value]?(n(),m("div",Z,[l(L,{modelValue:f.value,"onUpdate:modelValue":p[1]||(p[1]=i=>f.value=i)},{default:u(()=>[(n(),m(_,null,y(3,i=>l(K,{key:`window${i}`},{default:u(()=>[l(Q,{title:"Aktifitas"},{default:u(()=>[l(X,null,{default:u(()=>[(n(!0),m(_,null,y(v.value[a.value.value],s=>(n(),m("div",{key:s,class:"border rounded pa-3 mb-3"},[l(Y,{class:"position-relative"},{default:u(()=>[l(V,{cols:"12",md:"3"},{default:u(()=>[l(c,{modelValue:t.value[a.value.value].activities[s-1].brand,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].brand=r,items:C.value,label:"Brand",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(V,{cols:"12",md:"3"},{default:u(()=>[l(c,{modelValue:t.value[a.value.value].activities[s-1].task,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].task=r,items:T.value,label:"Tugas",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(V,{cols:"12",md:"3"},{default:u(()=>[l(c,{modelValue:t.value[a.value.value].activities[s-1].product,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].product=r,items:g.value,label:"Produk",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(V,{cols:"12",md:"3"},{default:u(()=>[l(k,{modelValue:t.value[a.value.value].activities[s-1].qty,"onUpdate:modelValue":r=>t.value[a.value.value].activities[s-1].qty=r,label:"Jumlah (Pcs)",placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),v.value[a.value.value]>1?(n(),B(w,{key:0,icon:"tabler-trash",color:"error",onClick:r=>F(s),class:"position-absolute",style:{top:"-20px",right:"-20px"}},null,8,["onClick"])):U("",!0)]),_:2},1024)]))),128)),x("div",ee,[l(w,{class:"mt-6","prepend-icon":"tabler-plus",onClick:N},{default:u(()=>[D(" Tambah ")]),_:1})])]),_:1})]),_:1})]),_:2},1024)),64))]),_:1},8,["modelValue"]),x("div",ae,[l(w,{class:"mt-6","prepend-icon":"tabler-check",color:"success",onClick:$},{default:u(()=>[D(" Simpan Semua ")]),_:1})])])):U("",!0)],64)}}});export{xe as default};
