import{_ as J}from"./VCheckboxBtn-DmiAe2E0.js";import{_ as O}from"./AppSelect.vue_vue_type_script_setup_true_lang-DY23fRQp.js";import{u as B}from"./useApi-D-Xd19RK.js";import{d as R,k as j,r as d,w as G,o as n,c as p,b as s,f as i,F as _,i as b,e as I,v as g,a6 as w,z as D,g as T,x as S}from"./main-DH2ALFZR.js";import{$ as W}from"./api-CXDLjLsU.js";import{V as z,a as L,b as H,c as K}from"./VWindowItem-CrtjARig.js";import{V as Q}from"./VCard-CLyqnDQG.js";import{V as X}from"./VCardText-BEHAJPOR.js";import{V as Y,a as V}from"./VRow-V8Pw_rgm.js";import"./VTextField-B4SiZ-lY.js";import"./index-W3V1Ew3k.js";import"./VImg-jozpSY2T.js";import"./VOverlay-BhaJNB49.js";import"./VSelect-B96USlCq.js";import"./VList-DxTpxwf2.js";import"./VAvatar-CJLjPKCj.js";import"./VDivider-U4ubAaMp.js";import"./VMenu-DKyQOLME.js";import"./VChip-Dnx5L31y.js";import"./index-BYrzgnBV.js";/* empty css              */const Z={key:0,style:{"font-weight":"bold","margin-left":"5px"}},ee={key:0,class:"mt-5"},ae={class:"d-flex justify-end"},te={class:"w-full d-flex justify-end"},Ue=R({__name:"index",setup(le){const E=j(),c=d([1]),C=d([]),P=d([]),x=d([]),U=d([]),l=d([]);(async()=>{try{const t=await B("/data-masters?all=1",{method:"GET"});if(t.data.value){const m=(await t.data.value).data,k=m.filter(e=>e.type_master_data==="task"),u=m.filter(e=>e.type_master_data==="produk"),o=m.filter(e=>e.type_master_data==="brand"),r=k.map(e=>({title:e.name,value:e.id})),M=u.map(e=>({title:e.name,value:e.id})),A=o.map(e=>({title:e.name,value:e.id})),h=(await(await B("/employees",{method:"GET"})).data.value).data.map(e=>({title:e.fullname,value:e.id})),y=localStorage.getItem("unsavedFormData");h.forEach((e,re)=>{y?(l.value[e.value]=JSON.parse(y)[e.value],c.value[e.value]=JSON.parse(y)[e.value].activities.length):(l.value[e.value]={employee:e.value,activities:[{qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"}]},c.value[e.value]=1)}),C.value=h,a.value=h[0],P.value=r,x.value=M,U.value=A}}catch(t){console.error(t)}})();const q=t=>{c.value[a.value.value]-=1,l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1),l.value[a.value.value].activities.splice(t,1)},F=()=>{c.value[a.value.value]=c.value[a.value.value]+1,l.value[a.value.value].activities.push({qty:null,brand:"Pilih Brand",task:"Pilih Tugas",product:"Pilih Produk"})},N=async()=>{await Promise.all(l.value.map(async t=>{if(t.activities[0].task&&t.activities[0].task!=="Pilih Tugas"&&t.activities[0].task!=="null"&&t.activities[0].qty>0){const v=await W("/activities",{method:"POST",body:{employee_id:t.employee,activities:t.activities}});console.log(v)}else console.log("Task is required")})),localStorage.removeItem("unsavedFormData"),E.replace("/apps/activities/list")};G(()=>l.value,t=>{localStorage.setItem("unsavedFormData",JSON.stringify(t))},{deep:!0});const f=d("window1"),a=d({title:"",value:1}),$=t=>{a.value=t,console.log(t)};return(t,v)=>{const m=O,k=J;return n(),p(_,null,[s(z,{modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=u=>f.value=u),class:"v-tabs-pill"},{default:i(()=>[(n(!0),p(_,null,b(C.value,(u,o)=>(n(),T(H,{onClick:r=>$(u),key:u.value},{default:i(()=>[g(S(o+1)+". "+S(u.title)+" ",1),l.value[u.value].activities[0].qty>0?(n(),p("span",Z," ["+S(l.value[u.value].activities.length)+"]",1)):D("",!0)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modelValue"]),l.value[a.value.value]?(n(),p("div",ee,[s(L,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=u=>f.value=u)},{default:i(()=>[(n(!0),p(_,null,b(c.value.length,u=>(n(),T(K,{key:`window${u}`},{default:i(()=>[s(Q,{title:"Aktifitas "+a.value.title},{default:i(()=>[s(X,null,{default:i(()=>[(n(!0),p(_,null,b(c.value[a.value.value],o=>(n(),p("div",{key:o,class:"border rounded pa-3 mb-3"},[s(Y,{class:"position-relative"},{default:i(()=>[s(V,{cols:"12",md:"3"},{default:i(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].brand,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].brand=r,items:U.value,label:"Brand",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:i(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].task,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].task=r,items:P.value,label:"Tugas",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:i(()=>[s(m,{modelValue:l.value[a.value.value].activities[o-1].product,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].product=r,items:x.value,label:"Produk",placeholder:"Select Item"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),s(V,{cols:"12",md:"3"},{default:i(()=>[s(k,{modelValue:l.value[a.value.value].activities[o-1].qty,"onUpdate:modelValue":r=>l.value[a.value.value].activities[o-1].qty=r,label:"Jumlah (Pcs)",placeholder:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),c.value[a.value.value]>1?(n(),T(w,{key:0,icon:"tabler-trash",color:"error",onClick:r=>q(o),class:"position-absolute",style:{top:"-20px",right:"-20px"}},null,8,["onClick"])):D("",!0)]),_:2},1024)]))),128)),I("div",ae,[s(w,{class:"mt-6","prepend-icon":"tabler-plus",onClick:F},{default:i(()=>[g(" Tambah ")]),_:1})])]),_:1})]),_:1},8,["title"])]),_:2},1024))),128))]),_:1},8,["modelValue"]),I("div",te,[s(w,{class:"mt-6","prepend-icon":"tabler-check",color:"success",onClick:N},{default:i(()=>[g(" Simpan Semua ")]),_:1})])])):D("",!0)],64)}}});export{Ue as default};
